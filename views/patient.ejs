<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - RaktConnect</title>
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        
        /* Custom dropdown styling */
        .custom-select {
            position: relative;
            width: 100%;
        }
        
        .custom-select select {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: white;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1.5em 1.5em;
            cursor: pointer;
        }
        
        .custom-select select:focus {
            outline: none;
            border-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }
        
        /* Make sure dropdown options are scrollable */
        select option {
            padding: 0.5rem;
            background-color: white;
            color: #1f2937;
        }
        
        /* For Firefox */
        select {
            -moz-appearance: none !important;
            text-indent: 1px;
            text-overflow: '';
        }
        
        /* For IE10+ */
        select::-ms-expand {
            display: none;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .nav-link {
            position: relative;
            transition: color 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: #ef4444;
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }
        
        .nav-link.active {
            color: #ef4444;
            font-weight: 500;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.3);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .search-input {
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }
        
        .search-input:focus {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        
        .donor-card {
            transition: all 0.3s ease;
        }
        
        .donor-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-tint text-red-600 text-2xl mr-2"></i>
                        <span class="text-xl font-bold text-gray-800">RaktConnect</span>
                    </div>
                    <div class="hidden md:ml-10 md:flex md:space-x-8">
                        <a href="#" class="nav-link active text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium">Dashboard</a>
                        <a href="#" class="nav-link text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">Requests</a>
                        <a href="#" class="nav-link text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">Haemoglobin</a>
                        <a href="#" class="nav-link text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium">Disease</a>
                    </div>
                </div>
                <div class="hidden md:ml-4 md:flex-shrink-0 md:flex md:items-center">
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="flex items-center max-w-xs rounded-full focus:outline-none" id="user-menu" aria-expanded="false" aria-haspopup="true">
                            <img class="h-8 w-8 rounded-full" src="https://ui-avatars.com/api/?name=<%= user.fullName %>&background=ef4444&color=fff" alt="User profile">
                            <span class="ml-2 text-sm font-medium text-gray-700"><%= user.fullName %></span>
                            <i class="fas fa-chevron-down ml-1 text-gray-500 text-xs"></i>
                        </button>
                        <div x-show="open" @click.away="open = false" class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5" role="menu" aria-orientation="vertical" aria-labelledby="user-menu">
                            <div class="py-1" role="none">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                                <a href="#" onclick="deleteAccount('<%= user._id %>')" class="block px-4 py-2 text-sm text-red-700 hover:bg-gray-100">Delete Account</a>
                                <a href="/get-started" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="-mr-2 flex items-center md:hidden">
                    <button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <i class="fas fa-bars h-6 w-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile menu -->
    <div class="md:hidden hidden" id="mobile-menu">
        <div class="pt-2 pb-3 space-y-1">
            <a href="#" class="bg-red-50 border-red-500 text-red-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Dashboard</a>
            <a href="#" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-800 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Requests</a>
            <a href="#" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-800 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Haemoglobin</a>
            <a href="#" class="border-transparent text-gray-600 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-800 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">Disease</a>
        </div>
        <div class="pt-4 pb-3 border-t border-gray-200">
            <div class="flex items-center px-4">
                <div class="flex-shrink-0">
                    <img class="h-10 w-10 rounded-full" src="https://ui-avatars.com/api/?name=Harsh+Patel&background=ef4444&color=fff" alt="User profile">
                </div>
                <div class="ml-3">
                    <div class="text-base font-medium text-gray-800">Harsh Patel</div>
                    <div class="text-sm font-medium text-gray-500">Patient</div>
                </div>
            </div>
            <div class="mt-3 space-y-1">
                <a href="#" class="block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100">Your Profile</a>
                <a href="#" class="block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100">Settings</a>
                <a href="#" class="block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100">Sign out</a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Welcome Banner -->
        <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-6 text-white mb-8 animate-fade-in">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h2 class="text-2xl font-bold mb-1">Welcome back, <%= user.fullName %></h2>
                    <p class="text-red-100">Check the status of your blood requests and find donors easily.</p>
                </div>
                <div class="flex items-center space-x-4 mt-4 md:mt-0">
                    <a href="#requests-section" class="bg-white text-red-600 px-6 py-2 rounded-lg font-medium hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-red-500">
                        View Requests
                    </a>
                    <button id="sosBtn" class="bg-red-700 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-800 transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-red-600 animate-pulse">
                        <i class="fas fa-bell"></i> SOS Request
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="glass-card rounded-xl p-6 mb-8 animate-slide-up" style="animation-delay: 0.1s;">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-hospital text-red-500 mr-3"></i>
                Find Blood Availability
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label for="state" class="block text-sm font-medium text-gray-700 mb-1">State</label>
                    <div class="custom-select">
                        <select id="state" class="w-full rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent" size="1">
                            <option value="">Select State</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="district" class="block text-sm font-medium text-gray-700 mb-1">District</label>
                    <div class="custom-select">
                        <select id="district" class="w-full rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent" size="1">
                            <option value="">Select District</option>
                            <!-- Will be populated by JavaScript -->
                        </select>
                    </div>
                </div>
                <div>
                    <label for="blood-type" class="block text-sm font-medium text-gray-700 mb-1">Blood Type</label>
                    <div class="custom-select">
                        <select id="blood-type" class="w-full rounded-lg border border-gray-300 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent" size="1">
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                </div>
                <div class="flex items-end">
                    <button id="searchHospitalsBtn" type="button" 
                            class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i> Search Hospitals
                    </button>
                </div>
                <div class="flex items-end">
                    <button id="useLocationBtn" type="button"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
                        <i class="fas fa-map-marker-alt mr-2"></i> Use My Location
                    </button>
                </div>
            </div>
            
            <!-- Search Results -->
            <div id="search-results" class="mt-8">
                <div id="search-status" class="text-center py-8">
                    <div class="text-gray-400 mb-2">
                        <i class="fas fa-search text-4xl"></i>
                    </div>
                    <h4 class="text-lg font-medium text-gray-600">Search for blood availability</h4>
                    <p class="text-sm text-gray-500">Select state, district and blood type to find available units</p>
                </div>
                <div id="map" style="height: 400px; width: 100%;" class="mt-6 rounded-lg"></div>
                <div id="hospitals-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
                    <!-- Hospitals will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 mb-8">
            <!-- Approved Requests -->
            <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.3s;">
                <div class="flex items-center">
                    <div class="p-3 rounded-lg bg-green-100 text-green-600 mr-4">
                        <i class="fas fa-check-circle text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Approved Requests</p>
                        <h3 class="text-2xl font-bold text-gray-800">5</h3>
                    </div>
                </div>
                <div class="mt-4 flex items-center text-sm text-green-600">
                    <i class="fas fa-arrow-up mr-1"></i>
                    <span>1 new today</span>
                </div>
            </div>

            <!-- Total Requests -->
            <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.4s;">
                <div class="flex items-center">
                    <div class="p-3 rounded-lg bg-blue-100 text-blue-600 mr-4">
                        <i class="fas fa-history text-xl"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Total Requests</p>
                        <h3 class="text-2xl font-bold text-gray-800">12</h3>
                    </div>
                </div>
                <div class="mt-4">
                    <a href="#" class="text-sm text-blue-600 hover:underline">View history</a>
                </div>
            </div>
        </div>

    <!-- Donors Results -->
    <div id="donors-results" class="mt-6 space-y-4">
        <!-- Donors will be loaded here -->
    </div>
</div>
        <div class="grid grid-cols-1 gap-6">
            <!-- Recent Blood Requests -->
            <div id="requests-section" class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.3s;">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Your Blood Requests</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Blood Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th>
                            </tr>
                        </thead>
                        <tbody id="patient-requests-table-body" class="divide-y divide-gray-200">
                            <!-- Dynamic content here -->
                        </tbody>
                    </table>
                </div>
            </div>
>>>>>>> Stashed changes
            
            <!-- Nearby Donors -->
            <div>
                <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.4s;">
            
            <!-- Nearby Donors -->
            <div>
                <div class="glass-card rounded-xl p-6 animate-slide-up" style="animation-delay: 0.4s;">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Nearby Donors</h3>
                        <button class="text-sm text-red-600 hover:text-red-700 focus:outline-none">View All</button>
                    </div>
                    <div class="space-y-4">
                        <!-- Donor 1 -->
                        <div class="donor-card flex items-center p-3 bg-white rounded-lg border border-gray-100 hover:shadow-md transition-all">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Donor" class="w-12 h-12 rounded-full object-cover">
                            <div class="ml-3 flex-1">
                                <h4 class="text-sm font-medium text-gray-800">Rahul Sharma</h4>
                                <div class="flex items-center mt-1">
                                    <span class="text-xs text-gray-500">O+ • 5km away</span>
                                </div>
                            </div>
                            <button class="ml-2 px-3 py-1 bg-red-50 text-red-600 text-xs font-medium rounded-full hover:bg-red-100 transition-colors">
                                Contact
                            </button>
                        </div>
                        
                        <!-- Donor 2 -->
                        <div class="donor-card flex items-center p-3 bg-white rounded-lg border border-gray-100 hover:shadow-md transition-all">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Donor" class="w-12 h-12 rounded-full object-cover">
                            <div class="ml-3 flex-1">
                                <h4 class="text-sm font-medium text-gray-800">Priya Patel</h4>
                                <div class="flex items-center mt-1">
                                    <span class="text-xs text-gray-500">A+ • 3km away</span>
                                </div>
                            </div>
                            <button class="ml-2 px-3 py-1 bg-red-50 text-red-600 text-xs font-medium rounded-full hover:bg-red-100 transition-colors">
                                Contact
                            </button>
                        </div>
                        
                        <!-- Donor 3 -->
                        <div class="donor-card flex items-center p-3 bg-white rounded-lg border border-gray-100 hover:shadow-md transition-all">
                            <img src="https://randomuser.me/api/portraits/men/67.jpg" alt="Donor" class="w-12 h-12 rounded-full object-cover">
                            <div class="ml-3 flex-1">
                                <h4 class="text-sm font-medium text-gray-800">Amit Kumar</h4>
                                <div class="flex items-center mt-1">
                                    <span class="text-xs text-gray-500">B+ • 7km away</span>
                                </div>
                            </div>
                            <button class="ml-2 px-3 py-1 bg-red-50 text-red-600 text-xs font-medium rounded-full hover:bg-red-100 transition-colors">
                                Contact
                            </button>
                        </div>
                        
                        <!-- Donor 4 -->
                        <div class="donor-card flex items-center p-3 bg-white rounded-lg border border-gray-100 hover:shadow-md transition-all">
                            <img src="https://randomuser.me/api/portraits/women/28.jpg" alt="Donor" class="w-12 h-12 rounded-full object-cover">
                            <div class="ml-3 flex-1">
                                <h4 class="text-sm font-medium text-gray-800">Neha Gupta</h4>
                                <div class="flex items-center mt-1">
                                    <span class="text-xs text-gray-500">AB+ • 4km away</span>
                                </div>
                            </div>
                            <button class="ml-2 px-3 py-1 bg-red-50 text-red-600 text-xs font-medium rounded-full hover:bg-red-100 transition-colors">
                                Contact
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <button class="text-sm text-red-600 hover:text-red-700 font-medium focus:outline-none">
                            Load More <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Include external JavaScript -->
    <script src="/script.js"></script>
    <script>
        const patientId = '<%= user._id %>';

        const statusStyles = {
            pending: 'bg-yellow-100 text-yellow-800',
            approved: 'bg-green-100 text-green-800',
            rejected: 'bg-red-100 text-red-800',
            delivering: 'bg-blue-100 text-blue-800',
            completed: 'bg-gray-100 text-gray-800'
        };

        async function fetchPatientRequests() {
            try {
                const response = await fetch(`/api/requests/patient/${patientId}`);
                const requests = await response.json();
                const tableBody = document.getElementById('patient-requests-table-body');
                tableBody.innerHTML = '';

                if (requests.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4">You have not made any requests yet.</td></tr>';
                    return;
                }

                requests.forEach(request => {
                    const statusClass = statusStyles[request.status] || 'bg-gray-100 text-gray-800';
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap font-medium">${request.bloodGroup}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(request.createdAt).toLocaleDateString()}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                    ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                ${request.status === 'delivering' ? 'Your blood is on the way!' : 'Status updated.'}
                            </td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            } catch (error) {
                console.error('Error fetching patient requests:', error);
            }
        }

        async function deleteAccount(patientId) {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                try {
                    const response = await fetch(`/api/patient/${patientId}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        alert('Account deleted successfully.');
                        window.location.href = '/get-started';
                    } else {
                        alert('Failed to delete account.');
                    }
                } catch (error) {
                    console.error('Error deleting account:', error);
                    alert('An error occurred.');
                }
            }
        }

        window.onload = fetchPatientRequests;
    </script>
    <script>
        const sosBtn = document.getElementById('sosBtn');
        sosBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;
                    const response = await fetch('/api/requests/sos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            patientId: '<%= user._id %>',
                            bloodGroup: '<%= user.bloodGroup %>',
                            city: '<%= user.city %>',
                            latitude,
                            longitude
                        })
                    });
                    const data = await response.json();
                    alert(data.message);
                    fetchPatientRequests();
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= process.env.GOOGLE_MAPS_API_KEY %>&callback=initMap"></script>
</body>
</html>
